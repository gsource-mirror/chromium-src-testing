# Copyright 2017 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a .pyl, or "Python Literal", file. You can treat it just like a
# .json file, with the following exceptions:
# * all keys must be quoted (use single quotes, please);
# * comments are allowed, using '#' syntax; and
# * trailing commas are allowed.

# Exceptions to the common test suites can only include removal from
# particular bots, and modifications on particular bots. By design,
# it's not possible to add one-off tests to bots. Instead they have to
# be added to one of the test suites in test_suites.pyl.
#
# Note that if you are excluding with variants, you will need to exclude
# per variant, with the identifier appended to the test suite name.
# For example, if you have ios_chrome_ui_eg2tests_module with variant
# SIM_IPHONE_6S_14_0 (identifier = "iPhone 6s 14.0"), you
# must exclude with the test name as:
# "ios_chrome_ui_eg2tests_module_iPhone 6s 14.0"

# The goal is to drive the number of exceptions to zero, to make all
# the bots behave similarly. whitespace
{
  'accessibility_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'args': [
            # TODO(crbug.com/40266898): Re-enable.
          '--gtest_filter=-AXPlatformNodeAuraLinuxTest.AtkComponentScrollTo:'
          'AtkUtilAuraLinuxTest.*',
        ],
      },
    },
  },
  'android_browsertests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'android_webview_unittests': {
  },
  'angle_unittests': {
    'remove_from': [
      # Times out listing tests crbug.com/1167314
      'android-asan',
    ],
  },
  'blink_web_tests': {
    'modifications': {
      'V8 Blink Linux Future': {
        'args': [
          '--flag-specific=future-js',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 8,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 4,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--timeout-ms',
          '66000',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 8,
        },
      },
      'devtools_frontend_linux_blink_light_rel': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 2,
        },
      },
      'devtools_frontend_linux_blink_light_rel_fastbuild': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 2,
        },
      },
      'linux-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--flag-specific=enable-editing-ng',
        ],
      },
      'mac11.0-blink-rel': {
        'swarming': {
          'shards': 5,
          'hard_timeout': 2400,
        },
      },
      'mac11.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win10.20h2-blink-rel': {
        'swarming': {
          'shards': 6,
          'hard_timeout': 2400,
        },
      },
      'win11-arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win11-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
    },
  },
  'blink_wpt_tests': {
    'remove_from': [
      'devtools_frontend_linux_blink_light_rel',
      'devtools_frontend_linux_blink_light_rel_fastbuild',
    ],
    'modifications': {
      'V8 Blink Linux Future': {
        'args': [
          '--flag-specific=future-js',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 12,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 6,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--timeout-ms',
          '66000',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 12,
        },
      },
      'linux-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--flag-specific=enable-editing-ng',
        ],
      },
      'mac11.0-blink-rel': {
        'swarming': {
          'shards': 7,
          'hard_timeout': 2400,
        },
      },
      'mac11.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win10.20h2-blink-rel': {
        'swarming': {
          'shards': 9,
          'hard_timeout': 2400,
        },
      },
      'win11-arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win11-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
    },
  },
  'browser_tests': {
    'remove_from': [
      'Linux TSan Tests',  # https://crbug.com/368525
      'linux-chromeos-chrome-preuprev', # http://b/331706144
    ],
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 10,
        },
      },
      'Linux ASan LSan Tests (1)': {
        'ci_only': True,
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 40,
        },
      },
      'Linux CFI': {
        'swarming': {
          'shards': 20,  # https://crbug.com/1361973
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        # And even more slow on linux-chromeos: crbug.com/1491533.
        'swarming': {
          'shards': 140,
          'hard_timeout': 7200,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot, most likely because browser_tests on cros has ~40% more tests. Also, these tests
        # run on ash, which means every test starts and shuts down ash, which most likely explains why it takes longer than on other platforms.
        # crbug.com/40585695 and crbug.com/326621525
        'swarming': {
          'shards': 100,
        },
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.msan.browser_tests.oobe_negative.filter',
        ],
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 23,
        },
      },
      'Linux UBSan Tests': {
        'swarming': {
          'shards': 20,
        }
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 30,
        },
        # crbug.com/1196416
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/mac.mac-rel.browser_tests.filter',
        ],
        'experiment_percentage': 100, # https://crbug.com/1251657
      },
      'linux-chromeos-chrome': {
        # TODO(crbug.com/40614042): Promote out of experiment when the
        # tests are green.
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 60,
        },
      },
    },
  },
  'capture_unittests': {
    'modifications': {
      'WebRTC Chromium Linux Tester': {
        'swarming': {
          'dimensions': {
            'os': 'Ubuntu-22.04|Ubuntu-18.04',
          },
        },
      },
    },
  },
  'cc_unittests': {
    'modifications': {
      'Linux TSan Tests': {
        'swarming': {
          'shards': 3,
        },
      },
    },
  },
  'chrome_all_tast_tests': {
    'modifications': {
      'chromeos-eve-chrome': {
        'swarming': {
          # Increased timeout to 4 hours due to shard timeout.
          'hard_timeout': 14400,
        }
      },
      # TODO(crbug.com/40727045): Move out of experimental if/when the bots are
      # stable.
      'chromeos-jacuzzi-chrome': {
        'experiment_percentage': 100,
      },
      'chromeos-reven-chrome': {
        'args': [
          '--tast-shard-method=hash',
        ],
      },
    },
  },
  'chrome_public_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'chrome_public_test_vr_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'chrome_public_unit_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'components_browsertests': {
    'modifications': {
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'swarming': {
          'shards': 3,
        },
      },
    },
  },
  'components_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'win-asan': {
        # TODO(crbug.com/41491387): With a single shard seems to hit time limit.
        'swarming': {
          'shards': 4,
        },
      },
    },
  },
  'content_browsertests': {
    'remove_from': [
      'linux-chromeos-chrome-preuprev', # http://b/331706144
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 24,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        'swarming': {
          'shards': 14, # https://crbug.com/1471857
        },
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 10, # https://crbug.com/1497706
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        'swarming': {
          'shards': 30,
        },
      },
      'Linux UBSan Tests': {
        'swarming': {
          'shards': 16,
        }
      },
      'Mac ASan 64 Tests (1)': { # https://crbug.com/1200640
        'experiment_percentage': 100,
      },
      'WebRTC Chromium FYI Android Tests (dbg)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      },
      'WebRTC Chromium FYI Android Tests ARM64 (dbg)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 25,
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          # ASAN bot is slow: https://crbug.com/1484550#c3
          'shards': 32,
        },
      },
    },
  },
  'content_shell_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'content_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'crashpad_tests': {
    'remove_from': [
      # https://crbug.com/crashpad/304
      'Linux TSan Tests',
      # https://crbug.com/crashpad/306
      'Linux CFI',
    ],
  },
  'expected_color_pixel_gl_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_metal_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_metal_passthrough_graphite_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_passthrough_test': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_passthrough_test JACUZZI_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (jacuzzi)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'expected_color_pixel_passthrough_test VOLTEER_PUBLIC_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (volteer)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'expected_color_pixel_validating_test': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'gcp_unittests': {
    'modifications': {
      # Flakily times out with only a single shard due to slow runtime.
      'win-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'gin_unittests': {
    'remove_from': [
      'Linux ASan LSan Tests (1)',  # https://crbug.com/831667
      'Linux Chromium OS ASan LSan Tests (1)',  # https://crbug.com/831667
    ],
  },
  'gl_tests_passthrough': {
    'remove_from': [
      # Can't run on MSAN because gl_tests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
    'modifications': {
      # TODO(kbr): figure out a better way to specify blocks of
      # arguments like this for tests on multiple machines.
      'Linux ASan LSan Tests (1)': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
      'Linux CFI': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
      'Linux TSan Tests': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
    },
  },
  'gl_unittests': {
    'remove_from': [
      # Can't run on MSAN because gl_unittests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
  },
  'gl_unittests_ozone': {
    'remove_from': [
      # Can't run on MSAN because gl_unittests_ozone uses the hardware driver,
      # which isn't instrumented.
      'Linux ChromiumOS MSan Tests',
    ],
  },
  'info_collection_tests': {
    'remove_from': [
      'Android V8 FYI Release (Nexus 5X)',
      'Linux V8 FYI Release (NVIDIA)',
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
      'Mac V8 FYI Release (Intel)',
      'Win V8 FYI Release (NVIDIA)',
    ],
  },
  'interactive_ui_tests': {
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 3,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the ASan trybot for some reason, crbug.com/1257927
        'swarming': {
          'shards': 12,
        },
      },
      'Linux CFI': {
        # Slow on certain debug builders, see crbug.com/1513713.
        'swarming': {
          'shards': 6,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASan trybot for some reason, crbug.com/1257927
        'swarming': {
          'shards': 12,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 5,
        },
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 8,
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the TSan bots for some reason, crbug.com/1257927
        'swarming': {
          'shards': 32, # Adjusted for testing, see https://crbug.com/1179567
        },
      },
      'Linux UBSan Tests': {
        'swarming': {
          'shards': 6,
        }
      },
      'Mac ASan 64 Tests (1)': { # https://crbug.com/1251656
        'experiment_percentage': 100,
      },
      # TODO(crbug.com/40630654): Remove these filters.
      'linux-chromeos-chrome': {
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          'shards': 9,
        },
      },
    },
  },
  'ipc_tests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'model_validation_tests MODEL_VALIDATION_BASE': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'mojo_unittests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'nacl_loader_unittests': {
    # If you change this, make similar changes in ppapi_unittests
    'remove_from': [
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'net_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 16,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 8,
        }
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 4,
        }
      },
      'win-asan': {
        # TODO(crbug.com/40200867): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
    },
  },
  'net_unittests RELEASE_LKGM': {
    # TODO(b/319364912): vpython cannot be delivered via CIPD on skylab builders
    'remove_from': [
      'chromeos-brya-chrome-dchecks-skylab',
      'chromeos-brya-chrome-skylab',
      'chromeos-brya-chrome-tests',
    ],
  },
  'notification_helper_unittests': {
    'remove_from': [
      # all these bots run Windows 7.
      'ToTWinOfficial',
      'ToTWinOfficial64',
    ],
  },
  'ondevice_stability_tests AMD Radeon RX 5500 XT': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ondevice_stability_tests Intel UHD 630': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ondevice_stability_tests NVIDIA GeForce GTX 1660': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ozone_unittests': {
    'modifications': {
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-chrome-preuprev': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
    },
  },
  'perfetto_unittests': {
    'remove_from': [
      # TODO(crbug.com/41440830): Fix permission issue when creating tmp files
      'android-asan',
    ]
  },
  'pixel_skia_gold_gl_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_metal_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_metal_passthrough_graphite_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_passthrough_test': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_passthrough_test JACUZZI_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (jacuzzi)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'pixel_skia_gold_passthrough_test VOLTEER_PUBLIC_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (volteer)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'pixel_skia_gold_validating_test': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'ppapi_unittests': {
    # If you change this, make similar changes in nacl_loader_unittests
    'remove_from': [
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'sandbox_linux_unittests': {
    'remove_from': [
      'android-asan',  # https://crbug.com/962650
    ],
  },
  'screenshot_sync_passthrough_tests': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
  },
  'screenshot_sync_validating_tests': {
    'modifications': {
      'android_optional_gpu_tests_rel': {
        'args': [
          # See Android FYI Release (Pixel 4).
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
  },
  'services_unittests': {
    'remove_from': [
      'Linux ChromiumOS MSan Tests',  # https://crbug.com/831676
      'Linux MSan Tests',  # https://crbug.com/831676
    ],
  },
  'sync_integration_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 4,
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        'swarming': {
          'shards': 6,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 3,
          },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'telemetry_perf_unittests': {
    'modifications': {
      'chromeos-eve-chrome': {
        'args': [
          # TODO(crbug.com/40756418): Re-enable.
          '--skip=benchmarks.benchmark_smoke_unittest.BenchmarkSmokeTest.wasmpspdfkit',
        ],
      },
    },
    'remove_from': [
      'Linux - Future (dbg)',  # client.v8.chromium
    ],
  },
  'telemetry_unittests': {
    'remove_from': [
      # TODO(crbug.com/40727045): Restore when there's more DUTs
      'chromeos-eve-chrome',
    ],
  },
  'trace_test 8086:9bc5': {
    'remove_from': [
      # TODO(crbug.com/41483572): Re-add this when capacity issues are resolved.
      'win_optional_gpu_tests_rel',
    ],
  },
  'unit_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 4,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 4,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Linux UBSan Tests': {
        'swarming': {
          'shards': 2,
        }
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.unit_tests.filter',
        ],
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'linux-chromeos-chrome-preuprev': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'win-asan': {
        'swarming': {
          # ASAN bot is slow: https://crbug.com/1484550#c4
          'shards': 4,
        },
      },
    },
  },
  'updater_tests_system': {
    'modifications': {
      'win-asan': {
        # crbug.com/369478225: These are slow and could timeout on the ASAN
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'variations_smoke_tests': {
    'modifications': {
      'linux-chrome': {
        'swarming': {
          'dimensions': {
            'pool': 'chrome.tests.finch',
          },
        },
      },
      'win-chrome': {
        'experiment_percentage': 100,
        'swarming': {
          'dimensions': {
            'pool': 'chrome.tests.finch',
          },
        },
      },
    },
  },
  'vulkan_pixel_skia_gold_test': {
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'webgl2_conformance_d3d11_passthrough_tests': {
    'remove_from': [
      # Removed from V8 builder since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Win V8 FYI Release (NVIDIA)',
    ],
  },
  'webgl2_conformance_d3d11_passthrough_tests 8086:9bc5': {
    'remove_from': [
      # TODO(crbug.com/41483572): Re-add this when capacity issues are resolved.
      'win_optional_gpu_tests_rel',
    ],
  },
  'webgl2_conformance_gl_passthrough_ganesh_tests': {
    'remove_from': [
      'Mac V8 FYI Release (Intel)',
    ],
  },
  'webgl2_conformance_gl_passthrough_tests': {
    'remove_from': [
      # Removed from V8 builders since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
    ],
  },
  'webgl2_conformance_metal_passthrough_graphite_tests': {
    'remove_from': [
      # Removed from V8 builders since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Mac V8 FYI Release (Intel)',
    ],
  },
  'webkit_unit_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Linux UBSan Tests': {
        'swarming': {
          'shards': 2,
        }
      },
      'win-asan': {
        'swarming': {
          'shards': 6,
        },
      },
    },
  },
  'webkit_unit_tests_v2':{
    'modifications': {
      'win-asan': {
        'swarming': {
          'shards': 6,  # crbug.com/326231701
        },
      },
    },
  },
  'webview_instrumentation_test_apk_multiple_process_mode': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'xr_browser_tests 8086:9bc5': {
    'modifications': {
      'win_optional_gpu_tests_rel': {
        'args': [
           # TODO(crbug.com/40937024): Remove this once the flakes on Intel are
           # resolved.
           '--gtest_filter=-WebXrVrOpenXrBrowserTest.TestNoStalledFrameLoop',
        ],
      },
    },
  },
}
